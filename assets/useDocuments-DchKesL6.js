import{o as P,p as b,q as x,j as y,l as N}from"./index-C1T0n0NP.js";import{Q as q,p as F,u as h,o as m}from"./Header-C-c1rW_a.js";var R=class extends q{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:P()})}getOptimisticResult(e){return e.behavior=P(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){var f,v;const{state:i}=e,s=super.createResult(e,t),{isFetching:c,isRefetching:a,isError:n,isRefetchError:l}=s,o=(v=(f=i.fetchMeta)==null?void 0:f.fetchMore)==null?void 0:v.direction,r=n&&o==="forward",u=c&&o==="forward",d=n&&o==="backward",g=c&&o==="backward";return{...s,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:x(t,i.data),hasPreviousPage:b(t,i.data),isFetchNextPageError:r,isFetchingNextPage:u,isFetchPreviousPageError:d,isFetchingPreviousPage:g,isRefetchError:l&&!r&&!d,isRefetching:a&&!u&&!g}}};function S(e,t){return F(e,R)}function Q({className:e,...t}){return y.jsx("div",{className:N("animate-pulse rounded-md bg-muted",e),...t})}function p(e="all",t=[]){const{nostr:i}=h();return S({queryKey:["documents",e,t],queryFn:async({pageParam:s,signal:c})=>{const a=AbortSignal.any([c,AbortSignal.timeout(5e3)]);let n=[];if(e==="connections"&&t.length>0){const r={authors:t,limit:20};s?n=[{kinds:[30023],...r,until:s},{kinds:[30024],...r,until:s}]:n=[{kinds:[30023],...r},{kinds:[30024],...r}]}else{const r={limit:20};s?n=[{kinds:[30023],...r,until:s},{kinds:[30024],...r,until:s}]:n=[{kinds:[30023],...r},{kinds:[30024],...r}]}const o=(await i.query(n,{signal:a})).sort((r,u)=>u.created_at-r.created_at);return{documents:o,nextCursor:o.length>0?o[o.length-1].created_at:void 0}},initialPageParam:void 0,getNextPageParam:s=>s.nextCursor})}function A(e,t){const{nostr:i}=h();return m({queryKey:["document",e,t],queryFn:async s=>{const c=AbortSignal.any([s.signal,AbortSignal.timeout(5e3)]),a={kinds:[30023,30024],"#d":[e],limit:1};return t&&(a.authors=[t]),(await i.query([a],{signal:c}))[0]},enabled:!!e})}function M(e){const{nostr:t}=h();return m({queryKey:["contacts",e],queryFn:async i=>{const s=AbortSignal.any([i.signal,AbortSignal.timeout(5e3)]),a=(await t.query([{kinds:[3],authors:[e],limit:1}],{signal:s}))[0];return a?a.tags.filter(n=>n[0]==="p"&&n[1]).map(n=>n[1]):[]},enabled:!!e})}export{Q as S,p as a,A as b,M as u};
