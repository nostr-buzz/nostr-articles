import{c as f,m as w}from"./index-C1T0n0NP.js";import{u as m,o as g}from"./Header-C-c1rW_a.js";import{u as k,m as A,s as h,h as S}from"./formatTime-Cjkn2NsU.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=f("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=f("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=f("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function K(n,t,a){const{nostr:e}=m();return g({queryKey:["reactions",n],queryFn:async s=>{const i=AbortSignal.any([s.signal,AbortSignal.timeout(5e3)]),l={kinds:[7],"#e":[n],limit:1e3},y=await e.query([l],{signal:i}),o=new Map;return y.forEach(r=>{const b=r.content.trim();if(b==="+"||b===""){const d=o.get(r.pubkey);(!d||r.created_at>d.created_at)&&o.set(r.pubkey,r)}}),{reactions:y,likes:Array.from(o.values()),likeCount:o.size}},enabled:!!n&&(a==null?void 0:a.enabled)!==!1})}function Z(n){const{user:t}=k(),{nostr:a}=m();return g({queryKey:["user-reaction",n,t==null?void 0:t.pubkey],queryFn:async e=>{if(!(t!=null&&t.pubkey))return null;const s=AbortSignal.any([e.signal,AbortSignal.timeout(5e3)]),i={kinds:[7],"#e":[n],authors:[t.pubkey],limit:1};return(await a.query([i],{signal:s}))[0]},enabled:!!n&&!!(t!=null&&t.pubkey)})}function L(){const{user:n}=k(),{mutate:t}=A(),a=w();return h({mutationFn:async({document:e,isLiked:s})=>{if(!n)throw new Error("Must be logged in to like documents");t(s?{kind:7,content:"-",tags:[["e",e.id,"",e.pubkey],["p",e.pubkey],["k",e.kind.toString()]]}:{kind:7,content:"+",tags:[["e",e.id,"",e.pubkey],["p",e.pubkey],["k",e.kind.toString()]]})},onSuccess:(e,{document:s})=>{a.invalidateQueries({queryKey:["reactions",s.id]}),a.invalidateQueries({queryKey:["user-reaction",s.id]})}})}function N(n,t){const{nostr:a}=m();return g({queryKey:["comments",n.id],queryFn:async e=>{const s=AbortSignal.any([e.signal,AbortSignal.timeout(5e3)]),i=S(n),l={kinds:[1111],"#A":[i],limit:500};return(await a.query([l],{signal:s})).sort((o,r)=>o.created_at-r.created_at)},enabled:!!n&&(t==null?void 0:t.enabled)!==!1})}function P(){const{user:n}=k(),{mutate:t}=A(),a=w();return h({mutationFn:async({document:e,content:s,parentComment:i})=>{if(!n)throw new Error("Must be logged in to comment");if(!s.trim())throw new Error("Comment content cannot be empty");const l=S(e),u=[["A",l],["K",e.kind.toString()],["P",e.pubkey]];return i?u.push(["e",i.id,"",i.pubkey],["k","1111"],["p",i.pubkey]):u.push(["a",l],["e",e.id,"",e.pubkey],["k",e.kind.toString()],["p",e.pubkey]),new Promise((y,o)=>{t({kind:1111,content:s.trim(),tags:u},{onSuccess:r=>{y(r)},onError:o})})},onSuccess:(e,{document:s})=>{a.invalidateQueries({queryKey:["comments",s.id]})}})}function Q(n,t){const{nostr:a}=m();return g({queryKey:["zaps",n],queryFn:async e=>{const s=AbortSignal.any([e.signal,AbortSignal.timeout(5e3)]),i={kinds:[9735],"#e":[n],limit:1e3},u=await a.query([i],{signal:s}),y=u.map(r=>{const b=r.tags.find(c=>c[0]==="bolt11"),d=r.tags.find(c=>c[0]==="description");let q=0,p=null;if(d&&d[1])try{p=JSON.parse(d[1]);const c=p.tags.find(v=>v[0]==="amount");c&&c[1]&&(q=parseInt(c[1])/1e3)}catch(c){console.warn("Failed to parse zap request:",c)}return{receipt:r,zapRequest:p,amount:q,bolt11:(b==null?void 0:b[1])||""}}),o=y.reduce((r,b)=>r+b.amount,0);return{zapReceipts:u,zapsWithAmounts:y,zapCount:u.length,totalAmount:o}},enabled:!!n&&(t==null?void 0:t.enabled)!==!1})}function x(){const{user:n}=k(),t=w();return h({mutationFn:async({document:a,amount:e,comment:s=""})=>{if(!n)throw new Error("Must be logged in to zap documents");if(e<=0)throw new Error("Zap amount must be greater than 0");if(!window.webln)throw new Error("WebLN wallet not found. Please install a WebLN-compatible wallet extension.");try{await window.webln.enable()}catch{throw new Error("Failed to connect to WebLN wallet. Please check your wallet extension.")}throw new Error("Zapping is not fully implemented yet. This requires LNURL integration with the author's lightning address.")},onSuccess:(a,{document:e})=>{t.invalidateQueries({queryKey:["zaps",e.id]})}})}export{C as H,_ as M,F as Z,N as a,Q as b,Z as c,L as d,P as e,x as f,K as u};
