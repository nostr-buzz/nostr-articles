import{c as $,e as ne,r as y,j as e,a as D,L as re,b as ie,u as ce,n as le}from"./index-C1T0n0NP.js";import{B as j,D as oe,j as de,k as me,l as xe,m as he,n as ue,I as je,g as G,A,a as L,b as z,U as F,H as S}from"./Header-C-c1rW_a.js";import{u as V,B as Z,L as q,C as O,c as J,j as K,d as Q,e as X,o as w,g as pe,a as ge,q as fe,b as Ne,f as ve,r as ye,i as we,F as H,P as U,l as be}from"./formatTime-Cjkn2NsU.js";import{T as W,S as M,a as ke,M as Ce,A as B}from"./ActionBar-BfeRKc21.js";import{u as De,c as Se,d as Be,a as Te,e as Ae,b as Le,f as ze,H as Fe,M as T,Z as Y}from"./useZaps-DHcz8WVT.js";import{b as Ze,S as u}from"./useDocuments-DchKesL6.js";import{C as Pe}from"./circle-alert-C1Ek57rN.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=$("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=$("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);function Re({document:s}){const{user:l}=V(),{toast:t}=ne(),{data:c}=De(s.id,s.pubkey),{data:n}=Se(s.id),{mutate:m,isPending:p}=Be(),{data:x=[]}=Te(s),{mutate:g,isPending:r}=Ae(),{data:a}=Le(s.id),{mutate:i,isPending:f}=ze(),[v,b]=y.useState(!1),[h,N]=y.useState(""),[d,ee]=y.useState(21),[P,I]=y.useState(""),k=(n==null?void 0:n.content)==="+",E=(c==null?void 0:c.likeCount)||0,C=x.length,R=(a==null?void 0:a.zapCount)||0,_=(a==null?void 0:a.totalAmount)||0,se=()=>{if(!l){t({title:"Login Required",description:"You need to be logged in to like documents.",variant:"destructive"});return}m({document:s,isLiked:k})},ae=()=>{if(!l){t({title:"Login Required",description:"You need to be logged in to comment.",variant:"destructive"});return}if(!h.trim()){t({title:"Error",description:"Comment cannot be empty.",variant:"destructive"});return}g({document:s,content:h},{onSuccess:()=>{N(""),t({title:"Success",description:"Comment posted successfully!"})},onError:o=>{t({title:"Error",description:o.message||"Failed to post comment.",variant:"destructive"})}})},te=()=>{if(!l){t({title:"Login Required",description:"You need to be logged in to zap documents.",variant:"destructive"});return}i({document:s,amount:d,comment:P},{onSuccess:()=>{I(""),t({title:"Success",description:`Zapped ${d} sats!`})},onError:o=>{t({title:"Error",description:o.message||"Failed to send zap.",variant:"destructive"})}})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 py-4 border-t border-b",children:[e.jsxs(j,{variant:k?"default":"outline",size:"sm",onClick:se,disabled:p,className:"flex items-center gap-2",children:[p?e.jsx(D,{className:"h-4 w-4 animate-spin"}):e.jsx(Fe,{className:`h-4 w-4 ${k?"fill-current":""}`}),E>0&&e.jsx("span",{children:E})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>b(!v),className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),C>0&&e.jsx("span",{children:C})]}),e.jsxs(oe,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(j,{variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),R>0&&e.jsx("span",{children:R}),_>0&&e.jsxs(Z,{variant:"secondary",className:"ml-1",children:[_," sats"]})]})}),e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(he,{children:"Send Lightning Zap"}),e.jsx(ue,{children:"Send sats to support this document via Lightning Network."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"zap-amount",children:"Amount (sats)"}),e.jsx(je,{id:"zap-amount",type:"number",value:d,onChange:o=>ee(parseInt(o.target.value)||0),min:"1",placeholder:"21"})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"zap-comment",children:"Comment (optional)"}),e.jsx(W,{id:"zap-comment",value:P,onChange:o=>I(o.target.value),placeholder:"Great article!",rows:2})]}),e.jsx(j,{onClick:te,disabled:f||d<=0,className:"w-full",children:f?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending Zap..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Zap ",d," sats"]})})]})]})]})]}),v&&e.jsxs(O,{children:[e.jsx(J,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Comments (",C,")"]})}),e.jsxs(Q,{className:"space-y-4",children:[l?e.jsxs("div",{className:"space-y-3",children:[e.jsx(W,{value:h,onChange:o=>N(o.target.value),placeholder:"Write a comment...",rows:3}),e.jsx("div",{className:"flex justify-end",children:e.jsx(j,{onClick:ae,disabled:r||!h.trim(),size:"sm",children:r?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-4 w-4 mr-2 animate-spin"}),"Posting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Post Comment"]})})}),e.jsx(M,{})]}):e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:e.jsx("p",{children:"You need to be logged in to comment."})}),x.length>0?e.jsx("div",{className:"space-y-4",children:x.map(o=>e.jsx(_e,{comment:o},o.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(T,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No comments yet. Be the first to comment!"})]})]})]})]})}function _e({comment:s}){var m;const t=(m=X(s.pubkey).data)==null?void 0:m.metadata,c=(t==null?void 0:t.display_name)||(t==null?void 0:t.name)||G(s.pubkey),n=t==null?void 0:t.picture;return e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(A,{className:"h-8 w-8",children:[e.jsx(L,{src:n,alt:c}),e.jsx(z,{children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:c}),e.jsx("span",{className:"text-xs text-muted-foreground",children:w(s.created_at)})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:s.content})]})]})}function qe({document:s}){var N;const{user:l}=V(),t=X(s.pubkey),c=pe(s),n=ge(s),m=fe(s),p=Ne(s),x=ve(s),g=ye(s),r=we(s),a=(N=t.data)==null?void 0:N.metadata,i=(a==null?void 0:a.display_name)||(a==null?void 0:a.name)||G(s.pubkey),f=a==null?void 0:a.picture,v=(l==null?void 0:l.pubkey)===s.pubkey,b=new Date(s.created_at*1e3),h=g?new Date(g*1e3):null;return e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl pb-12",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:r&&e.jsxs(Z,{variant:"secondary",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"Draft"]})}),v&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(j,{size:"sm",asChild:!0,children:e.jsxs(re,{to:`/edit/${x}`,children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Edit"]})})})]}),m&&e.jsx("div",{className:"mb-6",children:e.jsx("img",{src:m,alt:c,className:"w-full h-64 object-cover rounded-lg",onError:d=>{d.currentTarget.style.display="none"}})}),e.jsx("h1",{className:"text-4xl font-bold mb-4 text-gray-900 dark:text-gray-100",children:c}),n&&e.jsx("p",{className:"text-xl text-muted-foreground mb-6 leading-relaxed",children:n}),e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(A,{children:[e.jsx(L,{src:f,alt:i}),e.jsx(z,{children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),h?e.jsxs("span",{children:["Published ",w(g)]}):e.jsxs("span",{children:["Created ",w(s.created_at)]})]}),h&&h.getTime()!==b.getTime()&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"}),e.jsxs("span",{children:["Updated ",w(s.created_at)]})]})]})]})]})}),p.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:p.map(d=>e.jsxs(Z,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(ke,{className:"h-3 w-3"}),d]},d))}),e.jsx(M,{})]}),e.jsx("article",{className:"mb-8",children:s.content?e.jsx(Ce,{content:s.content}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"This document has no content."})]})}),e.jsx(Re,{document:s}),e.jsx("div",{className:"border-t pt-6",children:e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(A,{children:[e.jsx(L,{src:f,alt:i}),e.jsx(z,{children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(a==null?void 0:a.about)||"Nostr user"})]})]})})})]})}function Oe(){const{nip19:s}=ie(),l=ce();let t="",c="";if(s)if(s.startsWith("naddr1")||s.startsWith("nevent1")||s.startsWith("note1"))try{const r=le.decode(s);if(r.type==="naddr"){const a=r.data;t=a.identifier,c=a.pubkey}else if(r.type==="nevent"){const a=r.data;t=a.id,a.author&&(c=a.author)}else r.type==="note"&&(t=r.data)}catch(r){console.error("Failed to decode NIP-19 identifier:",r),t=s}else t=s;const{data:n,isLoading:m,error:p}=Ze(t,c),x=()=>{l("/")},g=async()=>{var r,a;if(navigator.share)try{await navigator.share({title:((r=n==null?void 0:n.tags.find(i=>i[0]==="title"))==null?void 0:r[1])||"Article",text:((a=n==null?void 0:n.tags.find(i=>i[0]==="summary"))==null?void 0:a[1])||"",url:window.location.href})}catch(i){console.log("Share cancelled or failed:",i)}else try{await navigator.clipboard.writeText(window.location.href)}catch(i){console.error("Failed to copy to clipboard:",i)}};return m?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(S,{}),e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-4xl",children:[e.jsx(B,{showBackButton:!0,onBack:x,backButtonText:"Back to Dashboard"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{className:"h-12 w-3/4"}),e.jsx(u,{className:"h-6 w-full"}),e.jsx(u,{className:"h-6 w-2/3"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{className:"h-4 w-full"}),e.jsx(u,{className:"h-4 w-full"}),e.jsx(u,{className:"h-4 w-3/4"}),e.jsx(u,{className:"h-4 w-full"}),e.jsx(u,{className:"h-4 w-2/3"})]})]})]})]}):p||!n?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(S,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx(B,{showBackButton:!0,onBack:x,backButtonText:"Back to Dashboard"}),e.jsxs(O,{className:"max-w-md mx-auto",children:[e.jsx(J,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-destructive"}),"Article Not Found"]})}),e.jsxs(Q,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"The article you're looking for could not be found. It may have been deleted or the link is incorrect."}),e.jsx(j,{onClick:()=>l("/"),className:"w-full",children:"Go to Dashboard"})]})]})]})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 pb-8",children:[e.jsx(S,{}),e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-4xl",children:e.jsx(B,{showBackButton:!0,onBack:x,backButtonText:"Back to Dashboard",children:e.jsxs(j,{variant:"outline",size:"sm",onClick:g,children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Share"]})})}),e.jsx(qe,{document:n})]})}export{Oe as default};
