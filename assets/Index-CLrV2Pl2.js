import{r as j,j as e,L as k,a as J}from"./index-C1T0n0NP.js";import{u as E,g as z,a as B,b as H,i as D,L as W,C as V,c as _,d as M,F as G,e as q,f as K,h as Q,j as X,B as A,k as Y,l as ee,P as se}from"./formatTime-Cjkn2NsU.js";import{B as w,P as R,S as te,I as ae,g as ne,A as re,a as le,b as ie,U as ce,H as oe,L as de}from"./Header-C-c1rW_a.js";import{u as me,a as ue,S}from"./useDocuments-DchKesL6.js";import{S as xe,E as he}from"./switch-C4PZvqPR.js";import{u as fe,a as ge,b as je,H as T,M as P,Z as O}from"./useZaps-DHcz8WVT.js";var I=new Map,L=new WeakMap,F=0,pe=void 0;function Ne(s){return s?(L.has(s)||(F+=1,L.set(s,F.toString())),L.get(s)):"0"}function ve(s){return Object.keys(s).sort().filter(a=>s[a]!==void 0).map(a=>`${a}_${a==="root"?Ne(s.root):s[a]}`).toString()}function be(s){const a=ve(s);let t=I.get(a);if(!t){const d=new Map;let i;const r=new IntersectionObserver(l=>{l.forEach(c=>{var m;const u=c.isIntersecting&&i.some(o=>c.intersectionRatio>=o);s.trackVisibility&&typeof c.isVisible>"u"&&(c.isVisible=u),(m=d.get(c.target))==null||m.forEach(o=>{o(u,c)})})},s);i=r.thresholds||(Array.isArray(s.threshold)?s.threshold:[s.threshold||0]),t={id:a,observer:r,elements:d},I.set(a,t)}return t}function we(s,a,t={},d=pe){if(typeof window.IntersectionObserver>"u"&&d!==void 0){const m=s.getBoundingClientRect();return a(d,{isIntersecting:d,target:s,intersectionRatio:typeof t.threshold=="number"?t.threshold:0,time:0,boundingClientRect:m,intersectionRect:m,rootBounds:m}),()=>{}}const{id:i,observer:r,elements:l}=be(t),c=l.get(s)||[];return l.has(s)||l.set(s,c),c.push(a),r.observe(s),function(){c.splice(c.indexOf(a),1),c.length===0&&(l.delete(s),r.unobserve(s)),l.size===0&&(r.disconnect(),I.delete(i))}}function ye({threshold:s,delay:a,trackVisibility:t,rootMargin:d,root:i,triggerOnce:r,skip:l,initialInView:c,fallbackInView:m,onChange:u}={}){var o;const[f,y]=j.useState(null),p=j.useRef(u),[h,v]=j.useState({inView:!!c,entry:void 0});p.current=u,j.useEffect(()=>{if(l||!f)return;let g;return g=we(f,(C,b)=>{v({inView:C,entry:b}),p.current&&p.current(C,b),b.isIntersecting&&r&&g&&(g(),g=void 0)},{root:i,rootMargin:d,threshold:s,trackVisibility:t,delay:a},m),()=>{g&&g()}},[Array.isArray(s)?s.toString():s,f,i,d,r,l,t,m,a]);const N=(o=h.entry)==null?void 0:o.target,n=j.useRef(void 0);!f&&N&&!r&&!l&&n.current!==N&&(n.current=N,v({inView:!!c,entry:void 0}));const x=[y,h.inView,h.entry];return x.ref=x[0],x.inView=x[1],x.entry=x[2],x}function Ce(s){const{ref:a,inView:t}=ye({threshold:.1,triggerOnce:!0,rootMargin:"100px"}),{data:d}=fe(s.id,s.pubkey,{enabled:t}),{data:i=[]}=ge(s,{enabled:t}),{data:r}=je(s.id,{enabled:t}),l=(d==null?void 0:d.likeCount)||0,c=i.length,m=(r==null?void 0:r.zapCount)||0,u=t&&(!d||!i||!r),o=l>0||c>0||m>0;return{ref:a,inView:t,likeCount:l,commentCount:c,zapCount:m,isLoading:u&&!o,hasInteractions:o}}function Se({showCreateButton:s=!0}){const{user:a}=E(),[t,d]=j.useState(""),[i,r]=j.useState("all"),[l,c]=j.useState(()=>{const n=localStorage.getItem("documents:showConnectionsOnly");return n?JSON.parse(n):!1}),{data:m=[]}=me((a==null?void 0:a.pubkey)||""),{data:u,isLoading:o,error:f,fetchNextPage:y,hasNextPage:p,isFetchingNextPage:h}=ue(l?"connections":"all",m),v=(u==null?void 0:u.pages.flatMap(n=>n.documents))||[],N=v.filter(n=>{const x=z(n).toLowerCase(),g=B(n).toLowerCase(),C=n.content.toLowerCase(),b=H(n),U=t===""||x.includes(t.toLowerCase())||g.includes(t.toLowerCase())||C.includes(t.toLowerCase())||b.some(Z=>Z.includes(t.toLowerCase())),$=i==="all"||i==="published"&&!D(n)||i==="drafts"&&D(n);return U&&$});return j.useEffect(()=>{localStorage.setItem("documents:showConnectionsOnly",JSON.stringify(l))},[l]),j.useEffect(()=>{const n=()=>{window.innerHeight+document.documentElement.scrollTop>=document.documentElement.offsetHeight-1e3&&p&&!h&&y()};return window.addEventListener("scroll",n),()=>window.removeEventListener("scroll",n)},[p,h,y]),f?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Failed to load articles. Please try again."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Articles"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your Nostr articles and drafts"})]}),s&&e.jsx(w,{asChild:!0,children:e.jsxs(k,{to:"/new",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"New Article"]})})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ae,{placeholder:"Search articles...",value:t,onChange:n=>d(n.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{variant:i==="all"?"default":"outline",size:"sm",onClick:()=>r("all"),children:"All"}),e.jsx(w,{variant:i==="published"?"default":"outline",size:"sm",onClick:()=>r("published"),children:"Published"}),e.jsx(w,{variant:i==="drafts"?"default":"outline",size:"sm",onClick:()=>r("drafts"),children:"Drafts"})]})]}),a&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xe,{id:"connections-only",checked:l,onCheckedChange:c}),e.jsxs(W,{htmlFor:"connections-only",children:["Show only articles from my connections (",m.length," contacts)"]})]})]}),o&&v.length===0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:6}).map((n,x)=>e.jsxs(V,{children:[e.jsxs(_,{children:[e.jsx(S,{className:"h-6 w-3/4"}),e.jsx(S,{className:"h-4 w-full"})]}),e.jsxs(M,{children:[e.jsx(S,{className:"h-4 w-full mb-2"}),e.jsx(S,{className:"h-4 w-2/3"})]})]},x))}):N.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map(n=>e.jsx(Le,{document:n},n.id))}),h&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(J,{className:"h-4 w-4 animate-spin"}),"Loading more articles..."]})}),p&&!h&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(w,{variant:"outline",onClick:()=>y(),children:"Load More Articles"})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(G,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No articles found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:t||i!=="all"||l?"Try adjusting your search or filter criteria.":"Get started by creating your first article."}),s&&!t&&i==="all"&&!l&&e.jsx(w,{asChild:!0,children:e.jsxs(k,{to:"/new",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Create Article"]})})]})]})}function Le({document:s}){var C;const{user:a}=E(),t=q(s.pubkey),d=z(s),i=B(s),r=H(s),l=D(s),c=K(s),m=Q(s),u=(a==null?void 0:a.pubkey)===s.pubkey,o=(C=t.data)==null?void 0:C.metadata,f=(o==null?void 0:o.display_name)||(o==null?void 0:o.name)||ne(s.pubkey),y=o==null?void 0:o.picture,{ref:p,likeCount:h,commentCount:v,zapCount:N,isLoading:n,hasInteractions:x}=Ce(s),g=s.content.length>150?s.content.substring(0,150)+"...":s.content;return e.jsxs(V,{ref:p,className:"hover:shadow-md transition-shadow flex flex-col h-full",children:[e.jsxs(_,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(X,{className:"text-lg line-clamp-2 flex-1",children:d}),e.jsx(A,{variant:l?"secondary":"default",className:"ml-2",children:l?"Draft":"Published"})]}),i&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:i})]}),e.jsxs(M,{className:"pt-0 flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-3",children:g}),r.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-4",children:[r.slice(0,3).map(b=>e.jsx(A,{variant:"outline",className:"text-xs",children:b},b)),r.length>3&&e.jsxs(A,{variant:"outline",className:"text-xs",children:["+",r.length-3]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-3 border-b",children:[e.jsxs(re,{className:"h-6 w-6",children:[e.jsx(le,{src:y,alt:f}),e.jsx(ie,{className:"text-xs",children:e.jsx(ce,{className:"h-3 w-3"})})]}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:f}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground ml-auto",children:[e.jsx(ee,{className:"h-3 w-3"}),Y(s.created_at)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:n?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-3 w-3 opacity-50"}),e.jsx("div",{className:"w-3 h-3 bg-muted rounded animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3 opacity-50"}),e.jsx("div",{className:"w-3 h-3 bg-muted rounded animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-3 w-3 opacity-50"}),e.jsx("div",{className:"w-3 h-3 bg-muted rounded animate-pulse"})]})]}):x?e.jsxs(e.Fragment,{children:[h>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-3 w-3"}),e.jsx("span",{children:h})]}),v>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),e.jsx("span",{children:v})]}),N>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-3 w-3"}),e.jsx("span",{children:N})]})]}):null}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{size:"sm",variant:"outline",asChild:!0,children:e.jsxs(k,{to:`/document/${m}`,children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),"View"]})}),u&&e.jsx(w,{size:"sm",variant:"outline",asChild:!0,children:e.jsxs(k,{to:`/edit/${c}`,children:[e.jsx(se,{className:"h-3 w-3 mr-1"}),"Edit"]})})]})]})]})]})}function ke(){const{user:s}=E();return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 pb-8",children:[e.jsx(oe,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[!s&&e.jsx("div",{className:"mb-8 p-6 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Welcome to Articles"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Browse and discover long-form articles on the Nostr network. Connect your Nostr account to create and publish your own articles."}),e.jsx(de,{className:"max-w-60 mx-auto"})]})}),e.jsx(Se,{showCreateButton:!!s})]})]})}const Pe=()=>e.jsx(ke,{});export{Pe as default};
